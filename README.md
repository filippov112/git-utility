# Git Utility

Консольная утилита для работы с Git, реализующая собственную модель ветвления с древовидной структурой коммитов.

## Установка и настройка

### 1. Установите зависимости

Убедитесь, что у вас установлены:
- .NET 8.0 SDK
- Git
- Доступ к интернету для работы с GitHub API

### 2. Настройте GitHub Token

1. Перейдите в GitHub Settings → Developer settings → Personal access tokens → Tokens (classic)
2. Создайте новый токен с правами:
   - `repo` (полный доступ к репозиториям)
   - `workflow` (если нужно работать с GitHub Actions)
3. Создайте файл `.env` в корне проекта:

```bash
GITHUB_TOKEN=ghp_ваш_токен_здесь
GITHUB_USERNAME=ваш_github_логин
```

### 3. Соберите проект

```bash
dotnet build
dotnet publish -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true
```

### 4. Добавьте в PATH (опционально)

Для удобства можно добавить папку с исполняемым файлом в PATH или создать алиас.

## Использование

### Команды

#### `init` - Инициализация репозитория
Создает новый Git-репозиторий с автоматической настройкой:
```bash
GitUtility init
```

Что делает:
- Инициализирует локальный Git-репозиторий
- Создает README.md и .gitignore (если отсутствуют)
- Делает начальный коммит
- Создает удаленный репозиторий на GitHub
- Связывает локальный и удаленный репозитории
- Загружает код на GitHub

#### `start` - Начало рабочей сессии
```bash
GitUtility start
```

Что делает:
- Проверяет наличие уже открытой сессии работы
- Сбрасывает все незафиксированные изменения
- Получает последние изменения с удаленного репозитория
- Создает новую рабочую ветку
- Инициализирует дерево коммитов

#### `fix` - Фиксация изменений
```bash
GitUtility fix [описание]
```

Примеры:
```bash
GitUtility fix
GitUtility fix "Добавлена новая функция"
```

**Важно:** Если команда `fix` вызывается без предварительного выполнения `start`, то сначала автоматически выполнится `start`, а затем `fix`.

Что делает:
- Проверяет наличие активной сессии работы (если нет - автоматически запускает `start`)
- Добавляет все изменения в staging area
- Создает коммит с указанным описанием (или "fix" по умолчанию)
- Сохраняет информацию о коммите в локальную базу данных
- При необходимости создает новые ветки для ответвлений

#### `prev` - Откат к предыдущему коммиту
```bash
GitUtility prev
```

Откатывает рабочий каталог к предыдущему коммиту в дереве. Если после этого выполнить `fix`, создастся новое ответвление.

#### `ch` - Переход к коммиту по номеру
```bash
GitUtility ch 5
```

Сначала фиксирует текущие изменения (если есть), затем переходит к указанному коммиту.

#### `show` - Отображение дерева коммитов
```bash
# Показать дерево всех коммитов
GitUtility show

# Показать детали конкретного коммита
GitUtility show 3
```

Пример вывода дерева:
```
start - 1 - 2 - 3  - 4  - 5
            |   +  - 6  - 7 - 8 
            |   |    |   + - 9 - 10
            |   |    +  - 14
            |   +  - 15 <- active
            + - 11 - 12 - 13
```

#### `save` - Сохранение и отправка изменений
```bash
GitUtility save
```

Что делает:
- Фиксирует текущие изменения (если есть)
- Отправляет все изменения на GitHub
- Создает Pull Request
- Возвращается на основную ветку
- Удаляет рабочую ветку
- Очищает дерево коммитов из памяти


#### `reset` - Сброс информации о текущей сессии
```bash
GitUtility reset
```

Что делает:
- Удаляет из памяти приложения информацию о данном репозитории

## Ограничения
- Команда `init` работает только в директориях, где еще нет Git-репозитория.
- Все остальные команды требуют наличия инициализированного Git-репозитория.

## Принцип работы

### Дерево коммитов

Утилита создает древовидную структуру коммитов, где:
- Каждый коммит имеет уникальный номер (1, 2, 3, ...)
- Коммиты могут иметь родительские коммиты
- При откате (`prev`) и последующей фиксации (`fix`) создается новое ответвление
- Можно переходить к любому коммиту в дереве (`ch`)

### База данных

Для хранения информации о дереве коммитов используется SQLite база данных, которая сохраняется в:
- Windows: `%APPDATA%/GitUtility/commits.db`
- macOS/Linux: `~/.config/GitUtility/commits.db`

### Ветвление

Утилита автоматически управляет Git-ветками:
- При `start` создается новая рабочая ветка
- При создании ответвлений могут создаваться дополнительные ветки
- При `save` все изменения объединяются через Pull Request

## Примеры использования

### Создание нового проекта
```bash
mkdir my-project
cd my-project
GitUtility init
```

### Обычный рабочий процесс
```bash
# Начинаем работу
GitUtility start

# Делаем изменения в коде
# ...

# Фиксируем изменения
GitUtility fix "Реализована базовая функциональность"

# Продолжаем работу
# ...

# Фиксируем еще изменения
GitUtility fix "Добавлены тесты"

# Просматриваем дерево
GitUtility show

# Завершаем работу и отправляем на GitHub
GitUtility save
```

### Работа без предварительного start
```bash
# Можно сразу вызвать fix - start выполнится автоматически
GitUtility fix "Первые изменения"

# Это эквивалентно:
# GitUtility start
# GitUtility fix "Первые изменения"
```

### Работа с ответвлениями
```bash
# Начинаем работу
GitUtility start

# Создаем несколько коммитов
GitUtility fix "Коммит 1"
GitUtility fix "Коммит 2"
GitUtility fix "Коммит 3"

# Откатываемся к коммиту 2
GitUtility prev

# Создаем новое ответвление
GitUtility fix "Альтернативная реализация"

# Просматриваем дерево
GitUtility show
# start - 1 - 2 - 3
#             + - 4 <- active

# Переходим к коммиту 3
GitUtility ch 3

# Продолжаем основную ветку
GitUtility fix "Продолжение основной ветки"

# Просматриваем финальное дерево
GitUtility show
# start - 1 - 2 - 3 - 5 <- active
#             + - 4
```

## Требования

- .NET 8.0 или выше
- Git (установлен и настроен)
- GitHub аккаунт с Personal Access Token
- Доступ к интернету

## Устранение неполадок

### "Git command failed"
Убедитесь, что Git установлен и доступен в PATH.

### "GITHUB_TOKEN не найден"
Проверьте наличие файла `.env` с правильными настройками.

### "Не удалось создать репозиторий на GitHub"
Проверьте:
- Правильность GitHub токена
- Наличие необходимых прав у токена
- Уникальность имени репозитория

### База данных заблокирована
При возникновении проблем с базой данных, можно удалить файл `commits.db` - он пересоздастся автоматически.